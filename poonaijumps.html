<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZIM - Code Creativity</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type="module">
      import zim from "https://zimjs.org/cdn/016/zim_physics";

      // See Docs under Frame for FIT, FILL, FULL, and TAG
      const assets = [
        "poonai1.png",
        "poonai2.png",
        "poonai3.png",
        "poonai4.png",
        "poonai5.png",
        "flames.png",
      ];
      const path = "assets/";
      new Frame(FIT, 1920, 1080, interstellar, dark, ready, assets, path);
      async function ready() {
        // given F (Frame), S (Stage), W (width), H (height)
        // put code here
        const fragmentResponse = await fetch("/shaders/halo.frag");
        const fragment = await fragmentResponse.text();

        // const infernoResponse = await fetch('/shaders/inferno.frag');
        // const infernoFrag = await infernoResponse.text();
        // const inferno = new Shader(W, 250, infernoFrag).loc(0, H-0.1*H);

        const flames = new Pic("flames.png")
          .sca(1.2)
          .pos(0, -10, CENTER, BOTTOM);
        const circleContainer = new Container(W - 150, H - 150)
          .centerReg()
          .pos(100, 100, LEFT, BOTTOM)
          .sca(1);
        // .drag({ all: true });
        const circleMask = new Circle(150, "gray")
          .centerReg()
          .pos(100, 0, LEFT, CENTER, circleContainer)
          .ord(-1)
          .alp(0.2);
        const halo = new Shader(W, H, fragment)
          .centerReg()
          .pos(555, 0, RIGHT, CENTER, circleContainer)
          .ord(2);
        halo.sca(0.39);

        // const poonaiCatcher = new Container(W - 150, H - 150)
        //   .reg(CENTER)
        //   .pos(100, 0, LEFT, CENTER)
        //   .sca(1)
        //   .drag({ all: true });
        // const catcherMask = new Circle(150, "gray")
        //   .pos(100,0,LEFT, CENTER, poonaiCatcher)
        //   .ord(-1)
        //   .alp(0.2);
        // const catcherShader = new Shader(W, H, fragment)
        //   .centerReg()
        //   .pos(-100,100,LEFT, BOTTOM, poonaiCatcher)
        //   .ord(2);
        // catcherShader.sca(0.39);

        const poonai1 = new Pic("poonai1.png").centerReg().vis(false);
        const poonai2 = new Pic("poonai2.png").centerReg().vis(false);
        const poonai3 = new Pic("poonai3.png").centerReg().vis(false);
        const poonai4 = new Pic("poonai4.png").centerReg().vis(false);
        const poonai5 = new Pic("poonai5.png").centerReg().vis(false);

        const poonais = [poonai1, poonai2, poonai3, poonai4, poonai5];

        loop(
          poonais,
          (poonai) => {
            poonai.pos(0, 0, CENTER, CENTER);
            poonai.addPhysics({
              bounciness: 0.5,
              linear: 0.3,
              shape: "circle",
            });
            poonai.impulse(1000, -2500);
            // poonai.sca(0.3);
            poonai.vis(true);
            // poonai.drag();

            // flames.on("tick", () => {
            //   if (poonai.hitTestRect(flames)) {
            //     S.removeChild(poonai);
            //     S.update();
            //   }
            // });
          },
          null,
          2
        );

        // const lava = new Rectangle(W, 250, red).loc(0, H-0.1*H);
        Ticker.add(poonaiRemover);
        function poonaiRemover() {
          loop(
            poonais,
            (poonai) => {
              // zog(poonai.y);
              // zog(inferno.y)
              if (poonai.y >= H - 100) {
                zog("burn");
                // S.removeChild(poonai);
                poonai.dispose();
                S.update();
              }
            },
            true
          );
        }

        const poonaisSaved = new Label({
          text: "Poonais Saved:",
          size: 38,
          font: "catboo",
          color: "white",
        }).pos(220, 60, RIGHT, TOP);
        const instructions = new Label({
          text: "Drag the circle to save the poonais",
          size: 25,
          font: "catboo",
          color: "white",
        }).pos(0, 300, CENTER, CENTER);
        const scorer = new Scorer({
          backgroundColor: yellow,
          color: black,
          isometric: RIGHT,
        }).loc(W - 100, 100);
        scorer.score++;
        scorer.score++;
        // new Timer({time:60,borderColor:dark,isometric:LEFT}).loc(W-100,100);
        const timer = new Container(200, 200).pos(50, 50, RIGHT, BOTTOM);
        const timerBG = new Rectangle(100, 100, "red").center(timer);
        const timerText = new Label({
          text: "60",
          size: 38,
          font: "catboo",
          color: "white",
        }).center(timer);
        interval(1, () => {
          timerText.text--;
        });

        // Ticker.add(poonaijump);
        // function poonaijump() {
        //   poonai1.force(40, 40, poonai1.x, poonai1.y);
        // }
        // Ticker.remove(poonaijump);
      } // end ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
